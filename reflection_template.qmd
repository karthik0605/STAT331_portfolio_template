---
title: "STAT 331 Portfolio"
author: "Karthik Balaji"
format: html 
theme: cyborg
embed-resources: true
layout: margin-left
editor: visual
execute: 
  eval: false
  echo: true
---

[**My Grade:**]{.underline} I believe my grade equivalent to course work evidenced below to be an A.

[**Learning Objective Evidence:**]{.underline} In the code chunks below, provide code from Lab or Challenge assignments where you believe you have demonstrated proficiency with the specified learning target. Be sure to specify **where** the code came from (e.g., Lab 4 Question 2).

## Working with Data

**WD-1: I can import data from a *variety* of formats (e.g., csv, xlsx, txt, etc.).**

-   `csv` Example 1

```{r}
#| label: wd-1-csv-1

# Lab 3 Question 2

teacher_evals <- read_csv(here::here("Week3", "Lab3", "teacher_evals.csv"))
```

-   `csv` Example 2

```{r}
#| label: wd-1-csv-2

# Lab 4 Question 0
childcare_costs <- read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-05-09/childcare_costs.csv')

counties <- read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-05-09/counties.csv')

tax_rev <- read_csv('https://atheobold.github.io/groupworthy-data-science/labs/instructions/data/ca_tax_revenue.csv')

```

-   `xlsx`

```{r}
#| label: wd-1-xlsx

# Practice Activity 4
military <- read_xlsx("gov_spending_per_capita.xlsx",
                      sheet = "Share of Govt. spending",
                      skip  = 7,
                      n_max = 191,
                      na = c("xxx", ". .", "..")
                      )
```

**WD-2: I can select necessary columns from a dataset.**

-   Example selecting specified columns

```{r}
#| label: wd-2-ex-1

# Lab 3 Question 5
teacher_evals_clean <- teacher_evals |>
    rename(sex = gender) |>
    filter(no_participants >= 10) |>
    mutate(
      across(c(teacher_id, course_id), as.character),
      across(c(question_no, no_participants, seniority), as.integer)
    ) |>
    select(
      course_id,
      teacher_id,
      question_no,
      no_participants,
      resp_share,
      SET_score_avg,
      percent_failed_cur,
      academic_degree,
      seniority,
      sex
    )
```

-   Example removing specified columns

```{r}
#| label: wd-2-ex-2

# Modified Lab 5 Step 1 to use removal of irrelevant columns
crime_scene_report |>
  mutate(date = ymd(date)) |>
  filter(date == mdy("January 15, 2018"),
         type == "murder",
         city == "SQL City") |>
  select(-date, -type, -city)
```

-   Example selecting columns based on logical values (e.g., `starts_with()`, `ends_with()`, `contains()`, `where()`)

```{r}
#| label: wd-2-ex-3

# Modified Lab 4 Question 7 to use starts_with instead of rename, makes code a lot cleaner
ca_childcare |>
  pivot_longer(
    cols = starts_with("mc_"),
    names_to  = "age_group",
    names_prefix = "mc_",
    values_to = "median_price"
  ) |>
  mutate(
    age_group = recode(age_group,
                       infant = "Infant",
                       toddler = "Toddler",
                       preschool = "Preschool"),
    region = fct_reorder2(region, study_year, median_price),
    age_group = fct_relevel(age_group, "Infant", "Toddler", "Preschool")
  ) |>
  ggplot(mapping = aes(x = study_year, y = median_price, color = region)) +
    geom_point() +
    scale_x_continuous(breaks = seq(2008, 2018, 2)) +
    scale_y_continuous(breaks = seq(0, 500, 100),
                       limits = c(100, 500)) +
    geom_smooth(method = "loess") +
    theme_bw() +
    labs(title = "Weekly Median Price for Center-Based Childcare ($)",
         x = "Study Year",
         y = NULL,
         color = "California Region") 
```

**WD-3: I can filter rows from a dataframe for a *variety* of data types (e.g., numeric, integer, character, factor, date).**

-   Numeric Example 1

```{r}
#| label: wd-3-numeric-ex-1

# Lab 4 Question 5
ca_childcare |> 
  filter(study_year %in% c(2008, 2018)) |>
  group_by(region, study_year) |>
  summarize(median_income = median(mhi_2018)) |>
  pivot_wider(names_from = study_year,
              values_from = median_income) |>
  arrange(desc(`2018`))
```

-   Numeric Example 2

```{r}
#| label: wd-3-numeric-ex-2

#Lab 3 Question 5
teacher_evals_clean <- teacher_evals |>
    rename(sex = gender) |>
    filter(no_participants >= 10) |>
    mutate(
      across(c(teacher_id, course_id), as.character),
      across(c(question_no, no_participants, seniority), as.integer)
    ) |>
    select(
      course_id,
      teacher_id,
      question_no,
      no_participants,
      resp_share,
      SET_score_avg,
      percent_failed_cur,
      academic_degree,
      seniority,
      sex
    )
```

-   Character Example 1 (any context)

```{r}
#| label: wd-3-character

# Lab 4 Question 2
ca_childcare <- left_join(x = childcare_costs,
                          y = counties,
                          by = "county_fips_code") |>
                filter(state_abbreviation == "CA") 
```

-   Character Example 2 (example must use functions from **stringr**)

```{r}
#| label: wd-3-string

# Lab 5 Part 2
person |>
  filter(str_detect(name, pattern = "^Annabel"),
         address_street_name == "Franklin Ave") |>
  left_join(interview, by = join_by(id == person_id)) |>
  select(transcript)
```

-   Date (example must use functions from **lubridate**)

```{r}
#| label: wd-3-date

# Lab 5 Part 4
facebook_event_checkin |>
  mutate(date = ymd(date)) |>
  filter(event_name == "SQL Symphony Concert",
         year(date) == 2017,
         month(date) == 12) |>
  count(person_id, name = "attendances") |>   
  filter(attendances == 3) |>
  left_join(person, by = join_by(person_id == id)) |>
  left_join(drivers_license, by = join_by(license_id == id)) |>
  filter(gender == "female",
         hair_color == "red",
         height %in% c(65, 66, 67),
         car_make == "Tesla",
         car_model == "Model S") |>
  select(name)
```

**WD-4: I can modify existing variables and create new variables in a dataframe for a *variety* of data types (e.g., numeric, integer, character, factor, date).**

-   Numeric Example 1

```{r}
#| label: wd-4-numeric-ex-1

# Lab 3 Question 5 (Modified to use names arguments for across syntax)
teacher_evals_clean <- teacher_evals |>
    rename(sex = gender) |>
    filter(no_participants >= 10) |>
    mutate(
      across(.cols = c(teacher_id, course_id), 
             .fns = ~ as.character(.x)),
      across(.cols = c(question_no, no_participants, seniority), 
             .fns = ~ as.integer(.x))
    ) |>
    select(
      course_id,
      teacher_id,
      question_no,
      no_participants,
      resp_share,
      SET_score_avg,
      percent_failed_cur,
      academic_degree,
      seniority,
      sex
    )
```

-   Numeric Example 2

```{r}
#| label: wd-4-numeric-ex-2

# Modified Lab 4 Question 5 to have better numerical column names

ca_childcare |>
  filter(study_year %in% c(2008, 2018)) |>
  mutate(mhi_2018_k = mhi_2018 / 1000) |>
  group_by(region, study_year) |>
  summarize(median_income_k = median(mhi_2018_k), .groups = "drop") |>
  pivot_wider(names_from = study_year, values_from = median_income_k) |>
  mutate(
    change_08_18_k = `2018` - `2008`,
    pct_change_08_18 = 100 * change_08_18_k / `2008`
  ) |>
  arrange(desc(`2018`))
```

-   Factor Example 1 (renaming levels)

```{r}
#| label: wd-4-factor-ex-1

# Lab 4 Question 4
ca_childcare <- ca_childcare |> 
  mutate(county_name = str_remove(county_name, " County"),
         region = fct_collapse(.f = county_name,
                               "Superior California" = superior_counties,
                               "North Coast" = north_coast_counties,
                               "San Francisco Bay Area" = san_fran_counties,
                               "Northern San Joaquin Valley" = n_san_joaquin_counties,
                               "Central Coast" = central_coast_counties,
                               "Southern San Joaquin Valley" = s_san_joaquin_counties,
                               "Inland Empire" = inland_counties,
                               "Los Angeles County" = la_county,
                               "Orange County" = orange_county,
                               "San Diego - Imperial" = san_diego_imperial_counties))
```

-   Factor Example 2 (reordering levels)

```{r}
#| label: wd-4-factor-ex-2

# Lab 4 Question 7
ca_childcare |>
  rename(
      Infant = mc_infant,
      Toddler = mc_toddler,
      Preschool = mc_preschool
  ) |>
  pivot_longer(cols = c(Infant, Toddler, Preschool),
               names_to = "age_group",
               values_to = "median_price"
               ) |>
  mutate(
    region = fct_reorder2(region, study_year, median_price),
    age_group = fct_relevel(age_group, "Infant", "Toddler", "Preschool")
  ) |>
  ggplot(mapping = aes(x = study_year, y = median_price, color = region)) +
    geom_point() +
    scale_x_continuous(breaks = seq(2008, 2018, 2)) +
    scale_y_continuous(breaks = seq(0, 500, 100),
                       limits = c(100, 500)) + #https://ggplot2.tidyverse.org/reference/scale_continuous.html
    facet_wrap(~ age_group) +
    geom_smooth(method = "loess") +
    theme_bw() +
    labs(title = "Weekly Median Price for Center-Based Childcare ($)",
         x = "Study Year",
         y = NULL,
         color = "California Region") 
```

-   Character (example must use functions from **stringr**)

```{r}
#| label: wd-4-string

# Lab 4 Question 4
ca_childcare <- ca_childcare |> 
  mutate(county_name = str_remove(county_name, " County"),
         region = fct_collapse(.f = county_name,
                               "Superior California" = superior_counties,
                               "North Coast" = north_coast_counties,
                               "San Francisco Bay Area" = san_fran_counties,
                               "Northern San Joaquin Valley" = n_san_joaquin_counties,
                               "Central Coast" = central_coast_counties,
                               "Southern San Joaquin Valley" = s_san_joaquin_counties,
                               "Inland Empire" = inland_counties,
                               "Los Angeles County" = la_county,
                               "Orange County" = orange_county,
                               "San Diego - Imperial" = san_diego_imperial_counties))
```

-   Date (example must use functions from **lubridate**)

```{r}
#| label: wd-4-date

# Lab 5 Part 4
facebook_event_checkin |>
  mutate(date = ymd(date)) |>
  filter(event_name == "SQL Symphony Concert",
         year(date) == 2017,
         month(date) == 12) |>
  count(person_id, name = "attendances") |>   
  filter(attendances == 3) |>
  left_join(person, by = join_by(person_id == id)) |>
  left_join(drivers_license, by = join_by(license_id == id)) |>
  filter(gender == "female",
         hair_color == "red",
         height %in% c(65, 66, 67),
         car_make == "Tesla",
         car_model == "Model S") |>
  select(name)

```

**WD-5: I can use mutating joins to combine multiple dataframes.**

-   `left_join()` Example 1

```{r}
#| label: wd-5-left-ex-1

# Lab 4 Question 2
ca_childcare <- left_join(x = childcare_costs,
                          y = counties,
                          by = "county_fips_code") |>
                filter(state_abbreviation == "CA") 

```

-   `right_join()` Example 1

```{r}
#| label: wd-5-right

# Modified Lab 5 Part 2 to be right join instead of left

#| label: wd-5-left-right-ex-2
person |>
  filter(address_street_name == "Northwestern Dr") |>
  slice_max(address_number) |>
  right_join(interview, by = join_by(id == person_id)) |>
  select(transcript)
```

-   `left_join()` **or** `right_join()` Example 2

```{r}
#| label: wd-5-left-right-ex-2

# Lab 4 Question 3
ca_childcare <- left_join(x = ca_childcare,
                          y = tax_rev,
                          by = join_by(county_name == entity_name,
                                       study_year == year))
```

-   `inner_join()` Example 1

```{r}
#| label: wd-5-inner-ex-1

# Challenge 4 (Modified to use join_by instead of deprecated function)
ca_childcare <- inner_join(
  center, family,
  by = join_by(county_fips_code, study_year, age_group)
)

```

-   `inner_join()` Example 2

```{r}
#| label: wd-5-inner-ex-2

# Modified Lab 5 Part 3
get_fit_now_member |>
  inner_join(get_fit_now_check_in, by = join_by(id == membership_id)) |>
  mutate(check_in_date = ymd(check_in_date)) |>
  filter(month(check_in_date) == 1,
         day(check_in_date) == 9,
         membership_status == "gold",
         str_detect(id, pattern = "48Z")) |>
  inner_join(person, by = join_by(person_id == id)) |>
  inner_join(drivers_license, by = join_by(license_id == id)) |>
  filter(str_detect(plate_number, pattern = "H42W")) |>
  inner_join(interview, by = "person_id") |>
  select(transcript)

```

**WD-6: I can use filtering joins to filter rows from a dataframe.**

-   `semi_join()`

```{r}
#| label: wd-6-semi

# Modified two parts of Lab 5 and joined into a semi-join for interviews

#| label: wd-5-semi
new_suspect <- facebook_event_checkin |>
  mutate(date = ymd(date)) |>
  filter(event_name == "SQL Symphony Concert",
         year(date) == 2017,
         month(date) == 12) |>
  count(person_id, name = "attendances") |>
  filter(attendances == 3) |>
  left_join(person, by = join_by(person_id == id)) |>
  left_join(drivers_license, by = join_by(license_id == id)) |>
  filter(gender == "female",
         hair_color == "red",
         height %in% c(65, 66, 67),
         car_make == "Tesla",
         car_model == "Model S") |>
  distinct(id)

interview |>
  semi_join(new_suspect, by = join_by(person_id == id)) |>
  pull(transcript)
```

-   `anti_join()`

```{r}
#| label: wd-6-anti

# Modified Lab 5 Part 5 to use anti-joins for suspects who weren't interviewed
person |>
  filter(name == "Miranda Priestly") |>
  anti_join(interview, by = join_by(id == person_id))

```

**WD-7: I can pivot dataframes from long to wide and visa versa**

-   `pivot_longer()`

```{r}
#| label: wd-7-long

# Lab 4 Question 7
a_childcare |>
  rename(
      Infant = mc_infant,
      Toddler = mc_toddler,
      Preschool = mc_preschool
  ) |>
  pivot_longer(cols = c(Infant, Toddler, Preschool),
               names_to = "age_group",
               values_to = "median_price"
               ) |>
  mutate(
    region = fct_reorder2(region, study_year, median_price),
    age_group = fct_relevel(age_group, "Infant", "Toddler", "Preschool")
  ) |>
  ggplot(mapping = aes(x = study_year, y = median_price, color = region)) +
    geom_point() +
    scale_x_continuous(breaks = seq(2008, 2018, 2)) +
    scale_y_continuous(breaks = seq(0, 500, 100),
                       limits = c(100, 500)) + #https://ggplot2.tidyverse.org/reference/scale_continuous.html
    facet_wrap(~ age_group) +
    geom_smooth(method = "loess") +
    theme_bw() +
    labs(title = "Weekly Median Price for Center-Based Childcare ($)",
         x = "Study Year",
         y = NULL,
         color = "California Region") 

```

-   `pivot_wider()`

```{r}
#| label: wd-7-wide

# Lab 4 Question 5
ca_childcare |> 
  filter(study_year %in% c(2008, 2018)) |>
  group_by(region, study_year) |>
  summarize(median_income = median(mhi_2018)) |>
  pivot_wider(names_from = study_year,
              values_from = median_income) |>
  arrange(desc(`2018`))
```

## Reproducibility

**R-1: I can create professional looking, reproducible analyses using RStudio projects, Quarto documents, and the here package.**

The following assignments satisfy the above criteria:

-   Example 1
    -   Lab 2
-   Example 2
    -   Lab 3
-   Example 3
    -   Challenge 3
-   Example 4
    -   Lab 7
-   Example 5
    -   Lab 9

**R-2: I can write well documented and tidy code.**

-   Example of **ggplot2** plotting

```{r}
#| label: r-2-1

# Lab 4 Question 7
a_childcare |>
  rename(
      Infant = mc_infant,
      Toddler = mc_toddler,
      Preschool = mc_preschool
  ) |>
  pivot_longer(cols = c(Infant, Toddler, Preschool),
               names_to = "age_group",
               values_to = "median_price"
               ) |>
  mutate(
    region = fct_reorder2(region, study_year, median_price),
    age_group = fct_relevel(age_group, "Infant", "Toddler", "Preschool")
  ) |>
  ggplot(mapping = aes(x = study_year, y = median_price, color = region)) +
    geom_point() +
    scale_x_continuous(breaks = seq(2008, 2018, 2)) +
    scale_y_continuous(breaks = seq(0, 500, 100),
                       limits = c(100, 500)) + #https://ggplot2.tidyverse.org/reference/scale_continuous.html
    facet_wrap(~ age_group) +
    geom_smooth(method = "loess") +
    theme_bw() +
    labs(title = "Weekly Median Price for Center-Based Childcare ($)",
         x = "Study Year",
         y = NULL,
         color = "California Region") 

```

-   Example of **dplyr** pipeline

```{r}
#| label: r-2-2

# Lab 5 Part 4
facebook_event_checkin |>
  mutate(date = ymd(date)) |>
  filter(event_name == "SQL Symphony Concert",
         year(date) == 2017,
         month(date) == 12) |>
  count(person_id, name = "attendances") |>   
  filter(attendances == 3) |>
  left_join(person, by = join_by(person_id == id)) |>
  left_join(drivers_license, by = join_by(license_id == id)) |>
  filter(gender == "female",
         hair_color == "red",
         height %in% c(65, 66, 67),
         car_make == "Tesla",
         car_model == "Model S") |>
  select(name)

```

-   Example of function formatting

```{r}
#| label: r-2-3

# Lab 8 Question 3
create_plot <- function(df, var_1, var_2) {
  x_is_num <- is.numeric(pull(df, {{ var_1 }}))
  y_is_num <- is.numeric(pull(df, {{ var_2 }}))

  x_lab <- str_to_title(str_replace_all(as_label(enquo(var_1)), "_", " "))
  y_lab <- str_to_title(str_replace_all(as_label(enquo(var_2)), "_", " "))
  #https://www.rdocumentation.org/packages/rlang/versions/1.0.6/topics/as_label
  #discusses use of enquo and label to use in multiple functions rather than {{}}
  #which wont work for the str_r and label

  p <- ggplot(df, aes(x = {{ var_1 }}, y = {{ var_2 }}, color = {{ var_1 }})) +
        labs(title = glue::glue("Comparison of {y_lab} and {x_lab} for penguins"),
             x = x_lab, 
             y = y_lab, 
             color = x_lab) +
        theme_bw()
  if (x_is_num && y_is_num) {
      p <- p + geom_point(alpha = 0.8)
  }
  else if (x_is_num || y_is_num) {
      p <- p + geom_jitter(alpha = 0.8)
  }
  else {
    p <- p + geom_count()
  }
  
  p + guides(color = "none")
  #https://stackoverflow.com/questions/11714951/remove-extra-legends-in-ggplot2
}
```

**R-3: I can write robust programs that are resistant to changes in inputs.**

-   Example (any context)

```{r}
#| label: r-3-example

# Lab 5 Part 2
person |>
  filter(address_street_name == "Northwestern Dr") |>
  slice_max(address_number) |>
  left_join(interview, by = join_by(id == person_id)) |>
  select(transcript)
```

-   Example (function stops)

```{r}
#| label: r-3-function-stops

# Challenge 7 Question 2
replace_unlikely <- function(vec, min_val, max_val) {
  if (!is.numeric(min_val)) {
    stop()
  }
  if (!is.numeric(max_val)) {
    stop()
  }
  vec[vec < min_val | vec > max_val] <- NA
  vec
}
```

## Data Visualization & Summarization

**DVS-1: I can create visualizations for a *variety* of variable types (e.g., numeric, character, factor, date)**

-   At least two numeric variables

```{r}
#| label: dvs-1-num

# Lab 4 Question 8
ca_childcare |>
  ggplot(mapping = aes(x = mhi_2018, y = mc_infant)) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(title = "Median Household Income vs Center Infant Childcare Prices, California",
       x = "Median Household Income (2018 dollars)",
       y = "Median Weekly Infant Price") +
  theme_bw()
```

-   At least one numeric variable and one categorical variable

```{r}
#| label: dvs-2-num-cat

# Lab 4 Question 7
a_childcare |>
  rename(
      Infant = mc_infant,
      Toddler = mc_toddler,
      Preschool = mc_preschool
  ) |>
  pivot_longer(cols = c(Infant, Toddler, Preschool),
               names_to = "age_group",
               values_to = "median_price"
               ) |>
  mutate(
    region = fct_reorder2(region, study_year, median_price),
    age_group = fct_relevel(age_group, "Infant", "Toddler", "Preschool")
  ) |>
  ggplot(mapping = aes(x = study_year, y = median_price, color = region)) +
    geom_point() +
    scale_x_continuous(breaks = seq(2008, 2018, 2)) +
    scale_y_continuous(breaks = seq(0, 500, 100),
                       limits = c(100, 500)) + #https://ggplot2.tidyverse.org/reference/scale_continuous.html
    facet_wrap(~ age_group) +
    geom_smooth(method = "loess") +
    theme_bw() +
    labs(title = "Weekly Median Price for Center-Based Childcare ($)",
         x = "Study Year",
         y = NULL,
         color = "California Region")
```

-   At least two categorical variables

```{r}
#| label: dvs-2-cat

# Challenge 3 Task 2
teacher_evals_compare |>
  ggplot(mapping = aes(x = sen_level, fill = SET_level)) +
  geom_bar(position = "fill") +
  scale_y_continuous(labels = scales::percent) + #https://stackoverflow.com/questions/27433798/how-can-i-change-the-y-axis-figures-into-percentages-in-a-barplot
  labs(title = "Evaluation of Teachers' Use of Activities",
       x = "Years of Experience",
       y = NULL,
       fill = "Evaluation Rating") +
  scale_fill_manual(values = c("excellent" = "plum3", "standard" = "tan3")) +
  theme_bw() +
  theme(legend.position = "top")
```

-   Dates (time series plot)

```{r}
#| label: dvs-2-date

# Challenge 4
ggplot(ca_childcare, aes(x = study_year, y = median_price, color = age_group)) +
  geom_point() +
  scale_x_continuous(breaks = seq(2008, 2018, 2)) +
  scale_y_continuous(limits = c(100, 500), 
                     breaks = seq(100, 500, 100)) +
  facet_wrap(~ care_type, nrow = 1) +
  geom_smooth(method = "loess") +
  theme_bw() +
  labs(
    title = "Median Weekly Price for Center-Based vs Family Childcare in California",
    x = "Study Year",
    y = "Median Weekly Price ($)",
    color = "Care Type"
  )
```

**DVS-2: I use plot modifications to make my visualization clear to the reader.**

-   I can modify my plot theme to be more readable

```{r}
#| label: dvs-2-ex-1

# Lab 4 Question 7
a_childcare |>
  rename(
      Infant = mc_infant,
      Toddler = mc_toddler,
      Preschool = mc_preschool
  ) |>
  pivot_longer(cols = c(Infant, Toddler, Preschool),
               names_to = "age_group",
               values_to = "median_price"
               ) |>
  mutate(
    region = fct_reorder2(region, study_year, median_price),
    age_group = fct_relevel(age_group, "Infant", "Toddler", "Preschool")
  ) |>
  ggplot(mapping = aes(x = study_year, y = median_price, color = region)) +
    geom_point() +
    scale_x_continuous(breaks = seq(2008, 2018, 2)) +
    scale_y_continuous(breaks = seq(0, 500, 100),
                       limits = c(100, 500)) + #https://ggplot2.tidyverse.org/reference/scale_continuous.html
    facet_wrap(~ age_group) +
    geom_smooth(method = "loess") +
    theme_bw() +
    labs(title = "Weekly Median Price for Center-Based Childcare ($)",
         x = "Study Year",
         y = NULL,
         color = "California Region")
```

-   I can modify my colors to be accessible to anyone's eyes

```{r}
#| label: dvs-2-ex-2

# Challenge 2 
ggplot(data = surveys, 
       mapping = aes(y = species, x = weight, color = sex)) +
  geom_boxplot(outlier.shape = NA) +
  labs(x = "Weight (grams)", y = "Species") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme_bw() + # Not part of the challenge, but wants to make the yellow pop out more
  scale_color_viridis_d() # Used this as it gave yellow and purple, the color scheme mentioned in class as best

```

-   I can modify my plot titles to clearly communicate the data context

```{r}
#| label: dvs-2-ex-3

# Modified Lab 4 Question 8 to have better titles
ca_childcare |>
  ggplot(aes(x = mhi_2018, y = mc_infant)) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(title = "Income vs Infant Care Prices",
       subtitle = "California counties (2008â€“2018)",
       x = "Median Household Income (2018$)",
       y = "Median Weekly Infant Price ($)") +
  theme_bw()

```

-   I can modify the text in my plot to be more readable

```{r}
#| label: dvs-2-ex-4

# Lab 2 Question 15
ggplot(data = surveys, 
       mapping = aes(x = species, y = weight)) +
  geom_boxplot(outlier.shape = NA) +
  geom_jitter(color = "orange3", alpha = 0.3) +
  labs(x = "Species", y = "Weight (grams)") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

-   I can reorder my legend to align with the colors in my plot

```{r}
#| label: dvs-2-ex-5

# Lab 4 Question 7
ca_childcare |>
  rename(
      Infant = mc_infant,
      Toddler = mc_toddler,
      Preschool = mc_preschool
  ) |>
  pivot_longer(cols = c(Infant, Toddler, Preschool),
               names_to = "age_group",
               values_to = "median_price"
               ) |>
  mutate(
    region = fct_reorder2(region, study_year, median_price),
    age_group = fct_relevel(age_group, "Infant", "Toddler", "Preschool")
  ) |>
  ggplot(mapping = aes(x = study_year, y = median_price, color = region)) +
    geom_point() +
    scale_x_continuous(breaks = seq(2008, 2018, 2)) +
    scale_y_continuous(breaks = seq(0, 500, 100),
                       limits = c(100, 500)) + #https://ggplot2.tidyverse.org/reference/scale_continuous.html
    facet_wrap(~ age_group) +
    geom_smooth(method = "loess") +
    theme_bw() +
    labs(title = "Weekly Median Price for Center-Based Childcare ($)",
         x = "Study Year",
         y = NULL,
         color = "California Region") 

```

**DVS-3: I show creativity in my visualizations**

-   I can use non-standard colors (Example 1)

```{r}
#| label: dvs-3-1-ex-1

# Challenge 2 
ggplot(data = surveys, 
       mapping = aes(y = species, x = weight, color = sex)) +
  geom_boxplot(outlier.shape = NA) +
  labs(x = "Weight (grams)", y = "Species") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme_bw() + # Not part of the challenge, but wants to make the yellow pop out more
  scale_color_viridis_d() # Used this as it gave yellow and purple, the color scheme mentioned in class as best
```

-   I can use non-standard colors (Example 2)

```{r}
#| label: dvs-3-1-ex-2

# Challenge 3 Question 2
teacher_evals_compare |>
  ggplot(mapping = aes(x = sen_level, fill = SET_level)) +
  geom_bar(position = "fill") +
  scale_y_continuous(labels = scales::percent) + #https://stackoverflow.com/questions/27433798/how-can-i-change-the-y-axis-figures-into-percentages-in-a-barplot
  labs(title = "Evaluation of Teachers' Use of Activities",
       x = "Years of Experience",
       y = NULL,
       fill = "Evaluation Rating") +
  scale_fill_manual(values = c("excellent" = "plum3", "standard" = "tan3")) +
  theme_bw() +
  theme(legend.position = "top")
```

-   I can use annotations (e.g., `geom_text()`)

```{r}
#| label: dvs-3-2

# Modified Lab 8 Question 4 Test 1 to use descriptive text annotation
my_plot <- ggplot(penguins, mapping = aes(x = species, fill = sex)) + 
  geom_bar() +
  geom_text(stat = "count",
            aes(label = after_stat(count)),
            position = position_stack(vjust = 0.5),
            color = "white",
            size = 3)

style_plot(my_plot, 
           theme_fn = theme_bw, 
           palette = RColorBrewer::brewer.pal(3, "Paired"), 
           aesthetic = "fill")
```

-   I can choose creative geometries (e.g., `geom_segment()`, `geom_ribbon)()`)

```{r}
#| label: dvs-3-3

# Modified Lab 10 Question 3 to do a different plot with geom_segment and geom_point
ggplot(babies_data, aes(x = babies, y = prop)) +
  geom_segment(aes(xend = babies, y = 0, yend = prop),
               size = 1, color = "darkred") +
  geom_point(size = 3, color = "darkred") +
  scale_y_continuous(
    labels = label_percent(),
  ) +
  labs(
    title = "Proportion of Correctly Returned Babies from 10,000 Simulated Nights",
    x = "Number of Babies Returned to the Correct Parent(s)",
    y = "Proportion of Simulations"
  ) +
  theme_bw() +
  theme(
    plot.title = element_text(face = "bold"))

```

**DVS-4: I can calculate numerical summaries of variables.**

-   Example using `summarize()`

```{r}
#| label: dvs-4-summarize

# Lab 3 Question 10
teacher_evals_clean |>
  filter(question_no == 901) |>
  group_by(teacher_id) |>
  summarize(course_count = n_distinct(course_id),
            mean_rating = mean(SET_score_avg, na.rm = TRUE)) |>
  arrange(desc(mean_rating))

```

-   Example using `across()`

```{r}
#| label: dvs-4-across

# Lab 3 Question 5 (Modified to use named arguments for across)
teacher_evals_clean <- teacher_evals |>
    rename(sex = gender) |>
    filter(no_participants >= 10) |>
    mutate(
      across(.cols = c(teacher_id, course_id), 
             .fns = ~ as.character(.x)),
      across(.cols = c(question_no, no_participants, seniority), 
             .fns = ~ as.integer(.x))
    ) |>
    select(
      course_id,
      teacher_id,
      question_no,
      no_participants,
      resp_share,
      SET_score_avg,
      percent_failed_cur,
      academic_degree,
      seniority,
      sex
    )
```

**DVS-5: I can find summaries of variables across multiple groups.**

-   Example 1

```{r}
#| label: dvs-5-1

# Lab 4 Question 5
ca_childcare |> 
  filter(study_year %in% c(2008, 2018)) |>
  group_by(region, study_year) |>
  summarize(median_income = median(mhi_2018)) |>
  pivot_wider(names_from = study_year,
              values_from = median_income) |>
  arrange(desc(`2018`))

```

-   Example 2

```{r}
#| label: dvs-5-2

# Lab 3 Question 12
teacher_evals_clean |>
  group_by(teacher_id, seniority, sex) |>
  filter(academic_degree %in% c("dr", "prof")) |>
  summarize(mean_resp = mean(resp_share, na.rm = TRUE), .groups = "drop") |>
  arrange(desc(mean_resp))
```

**DVS-6: I can create tables which make my summaries clear to the reader.**

-   I can modify my column names to clearly communicate the data context

```{r}
#| label: dvs-6-ex-1

# Lab 4 Question 7
ca_childcare |>
  rename(
      Infant = mc_infant,
      Toddler = mc_toddler,
      Preschool = mc_preschool
  ) |>
  pivot_longer(cols = c(Infant, Toddler, Preschool),
               names_to = "age_group",
               values_to = "median_price"
               ) |>
  mutate(
    region = fct_reorder2(region, study_year, median_price),
    age_group = fct_relevel(age_group, "Infant", "Toddler", "Preschool")
  ) |>
  ggplot(mapping = aes(x = study_year, y = median_price, color = region)) +
    geom_point() +
    scale_x_continuous(breaks = seq(2008, 2018, 2)) +
    scale_y_continuous(breaks = seq(0, 500, 100),
                       limits = c(100, 500)) + #https://ggplot2.tidyverse.org/reference/scale_continuous.html
    facet_wrap(~ age_group) +
    geom_smooth(method = "loess") +
    theme_bw() +
    labs(title = "Weekly Median Price for Center-Based Childcare ($)",
         x = "Study Year",
         y = NULL,
         color = "California Region") 
```

-   I can modify the text in my table to be more readable (e.g., bold face for column headers)

```{r}
#| label: dvs-6-ex-2

# Lab 9 Question 8
map_int(fish, ~ sum(is.na(.x))) |>
  enframe(name = "Measurement Variable", value = "Missing Values") |>
  gt() |>
  tab_header(
    title    = "Number of Missing Values for Fish Measurements",
    subtitle = "Data Collected from 1989 to 2006 on the Blackfoot Fish River in Montana"
  ) |>
  tab_options(column_labels.font.weight = "bold") |>
   data_color(
    columns = `Missing Values`,
    fn = function(x) case_when(
      x == 0 ~ "darkgreen", 
      x >  0 ~ "darkred",  
    )
   )
```

-   I can arrange my table to have an intuitive ordering

```{r}
#| label: dvs-6-ex-3

# Lab 4 Question 5
ca_childcare |> 
  filter(study_year %in% c(2008, 2018)) |>
  group_by(region, study_year) |>
  summarize(median_income = median(mhi_2018)) |>
  pivot_wider(names_from = study_year,
              values_from = median_income) |>
  arrange(desc(`2018`))
```

**DVS-7: I show creativity in my tables.**

-   I can use non-default colors

```{r}
#| label: dvs-7-ex-1

# Challenge 2 
ggplot(data = surveys, 
       mapping = aes(y = species, x = weight, color = sex)) +
  geom_boxplot(outlier.shape = NA) +
  labs(x = "Weight (grams)", y = "Species") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme_bw() + # Not part of the challenge, but wants to make the yellow pop out more
  scale_color_viridis_d() # Used this as it gave yellow and purple, the color scheme mentioned in class as best
```

-   I can modify the layout of my table to be more readable (e.g., `pivot_longer()` or `pivot_wider()`)

```{r}
#| label: dvs-7-ex-2

# Lab 4 Question 5
ca_childcare |> 
  filter(study_year %in% c(2008, 2018)) |>
  group_by(region, study_year) |>
  summarize(median_income = median(mhi_2018)) |>
  pivot_wider(names_from = study_year,
              values_from = median_income) |>
  arrange(desc(`2018`))
```

## Program Efficiency

**PE-1: I can write concise code which does not repeat itself.**

-   using a single function call with multiple inputs (rather than multiple function calls)

```{r}
#| label: pe-1-one-call

# Lab 5 Part 1
crime_scene_report |>
  mutate(date = ymd(date)) |>
  filter(date == mdy("January 15, 2018"),
         type == "murder",
         city == "SQL City") |>
  select(description)
```

-   using `across()`

```{r}
#| label: pe-1-across

# Lab 7 Question 1
fish_missing <- fish |>
  summarize(
    obs_missing = sum(if_any(where(~ any(is.na(.x))), is.na)),
    across(
      .cols = where(~ any(is.na(.x))),   
      .fns = ~ sum(is.na(.x)),
      .names = "n_missing_{.col}"
    )
  )

fish_missing
```

-   using functions from the `map()` family

```{r}
#| label: pe-1-map-1

# Lab 10 Question 1
results <- map_int(.x = 1:10000,
                   .f = ~ randomBabies(4)
                  )
```

**PE-2: I can write functions to reduce repetition in my code.**

-   Example 1: Function that operates on vectors

```{r}
#| label: pe-2-1

# Challenge 7 Question 2
replace_unlikely <- function(vec, min_val, max_val) {
  if (!is.numeric(min_val)) {
    stop()
  }
  if (!is.numeric(max_val)) {
    stop()
  }
  vec[vec < min_val | vec > max_val] <- NA
  vec
}
```

-   Example 2: Function that operates on data frames

```{r}
#| label: pe-2-2

# Lab 8 Question 2
pivot_table <- function(data, row_var, col_var) {
  data |>
    count({{ row_var }}, 
          {{ col_var }}) |>
    pivot_wider(
      names_from  = {{ col_var }},
      values_from = n,
      values_fill = 0
    ) |>
    janitor::adorn_totals("both")
}
```

-   Example 3: Function that operates on vectors *or* data frames

```{r}
#| label: pe-2-3

# Lab 10 Question 1
rescale_01 <- function(vec){
  if(!is.numeric(vec)) {
    stop()
  }
  if(length(vec) <= 1){
    stop()
  }

  rng <- range(vec, na.rm = TRUE)
  width <- diff(rng)

  (vec - rng[1]) / width
}
  
rescale_column <- function(df, cols) {
    df |>
      mutate(across(.cols = {{ cols }}, 
                    .fns = ~ rescale_01(.x)))
}
```

**PE-3:I can use iteration to reduce repetition in my code.**

-   using `across()`

```{r}
#| label: pe-3-across

# Lab 8 Question 1 (Modified to use named arguments for across)
rescale_01 <- function(vec){
  if(!is.numeric(vec)) {
    stop()
  }
  if(length(vec) <= 1){
    stop()
  }

  rng <- range(vec, na.rm = TRUE)
  width <- diff(rng)

  (vec - rng[1]) / width
}
  
rescale_column <- function(df, cols) {
    df |>
      mutate(across(.cols = {{ cols }}, 
                    .fns = ~ rescale_01(.x)))
}
```

-   using a `map()` function with **one** input (e.g., `map()`, `map_chr()`, `map_dbl()`, etc.)

```{r}
#| label: pe-3-map-1

# Lab 9 Question 2
map_chr(surveys, typeof) |>
  enframe(name = "Variable", value = "Data Type") |>
  kable()
```

-   using a `map()` function with **one** input

```{r}
#| label: pe-3-map-2

# Lab 9 Question 4
evals_new <- map_if(evals, is.character, as.factor) |>
  bind_cols()
```

**PE-4: I can use modern tools when carrying out my analysis.**

-   I can use functions which are not superseded or deprecated

```{r}
#| label: pe-4-1

# Lab 5 Part 3
get_fit_now_member |>
  left_join(get_fit_now_check_in, by = join_by(id == membership_id)) |>
  mutate(check_in_date = ymd(check_in_date)) |>
  filter(month(check_in_date) == 1,
         day(check_in_date) == 9,
         membership_status == "gold",
         str_detect(id, pattern = "48Z")) |>
  left_join(person, by = join_by(person_id == id)) |>
  left_join(drivers_license, by = join_by(license_id == id)) |>
  filter(str_detect(plate_number, pattern = "H42W")) |>
  left_join(interview, by = "person_id") |>
  select(transcript)
```

-   I can connect a data wrangling pipeline into a `ggplot()`

```{r}
#| label: pe-4-2

# Lab 4 Question 7
ca_childcare |>
  rename(
      Infant = mc_infant,
      Toddler = mc_toddler,
      Preschool = mc_preschool
  ) |>
  pivot_longer(cols = c(Infant, Toddler, Preschool),
               names_to = "age_group",
               values_to = "median_price"
               ) |>
  mutate(
    region = fct_reorder2(region, study_year, median_price),
    age_group = fct_relevel(age_group, "Infant", "Toddler", "Preschool")
  ) |>
  ggplot(mapping = aes(x = study_year, y = median_price, color = region)) +
    geom_point() +
    scale_x_continuous(breaks = seq(2008, 2018, 2)) +
    scale_y_continuous(breaks = seq(0, 500, 100),
                       limits = c(100, 500)) + #https://ggplot2.tidyverse.org/reference/scale_continuous.html
    facet_wrap(~ age_group) +
    geom_smooth(method = "loess") +
    theme_bw() +
    labs(title = "Weekly Median Price for Center-Based Childcare ($)",
         x = "Study Year",
         y = NULL,
         color = "California Region") 
```

## Data Simulation & Statisical Models

**DSSM-1: I can simulate data from a *variety* of probability models.**

-   Example 1

```{r}
#| label: dsm-1-1

# Lab 10 Question 4
# define slope and intercept parameters
intercept = 2
slope = 1

# generate x vector
x = runif(n = 100, min = 0, max = 1)

# generate noise `ep` vector
ep = rnorm(n = 100, mean = 0, sd = 1)

# generate outcome from population model
y = intercept + x*slope + ep


# create an "observed data" dataframe with only the x and y vectors
obs_data <- data.frame(x, y)
obs_data
```

-   Example 2

```{r}
#| label: dsm-1-2

# Lab 10 Question 8
mycifun <- function(beta0, beta1, n) {
  x  <- runif(n, min = 0, max = 1)
  ep <- rnorm(n, mean = 0, sd = 1)  
  y  <- beta0 + beta1 * x + ep
  obs_data <- data.frame(x, y)

  model <- lm(y ~ x, data = obs_data)

  model_tidy <- tidy(model, conf.int = TRUE)
  
  model_tidy |>
    mutate(cover = ifelse(term == "x" &
                            beta1 >= conf.low &
                            beta1 <= conf.high, 1, 0)) |>
    filter(term == "x") |>
    select(
      slope_hat = estimate,
      ci_low = conf.low,
      ci_high = conf.high,
      cover
    )
}
```

**DSSM-2: I can conduct common statistical analyses in R.**

-   Example 1

```{r}
#| label: dsm-2-1

# Lab 2 Question 17
species_mod <- aov(weight ~ species, data = surveys)
summary(species_mod)
```

-   Example 2

```{r}
#| label: dsm-2-2

# Lab 4 Question 9
reg_mod1 <- lm(mc_infant ~ mhi_2018, data = ca_childcare)
summary(reg_mod1)

```

-   Example 3

```{r}
#| label: dsm-2-3

#Lab 1 Question 9
t.test(len ~ supp, data = ToothGrowth)
```

## Revising My Thinking

<!-- How did you revise your thinking throughout the course? How did you revise your thinking on the code examples you have provided in your portfolio? -->

Throughout the course, I spent a lot of time looking back on code I got feedback for. The nature of the feedback varies, from peer feedback to professor feedback, but there was usually something to change, whether small or big. While I just kept the small changes in the back of my mine, I usually went and resubmitted any larger changes. Oftentimes, the feedback helped me consider different approaches to my work, and made my work cleaner or more understandable. For instance, I received a lot of feedback about making my labels and titles more descriptive, which I keep in mine for future assignments. For the code examples in the portfolio, this was also valuable as I once again went back and searched for what code chunks were the best examples for each of the learning targets. It allowed me to really think about what a code chunk is doing, and again if there are any other better ways to do something.

<!-- For the revisions included in your Portfolio, to help me understand the nature of your revisions, please denote somehow the feedback I provided you (e.g., boldface, italics, colored text) before your revisions. -->

Will do the boldface in my final reflection, or after meeting on Monday. Mostly had to do with different descriptions/labels, or different ways of using dplyr functions.

## Extending My Thinking

<!-- How did you extended your thinking throughout the course? How did you extend your thinking on the code examples you have provided in your portfolio? -->

Throughout the course, I found a common theme to be that much of the course content is repeated. For instance, we learned how to build plots first, but then continued using them when we learned dplyr pipelines. We simply expanded the use cases for them, to build more descriptive or meaningful plots. I feel like this is a core theme in this course and many courses; continuing to revise past content through the application of such content later in the course is critical to expanding one's thinking, and helped me in this course. For the portfolio, as mentioned before, actually thinking about relevant examples for each chunk was a great experience. Additionally, actually modifying my code chunks for targets I didn't have an example for made me think about different approaches to the same problem, and were sometimes cleaner than what I had originally done. This is a core part of expanding my thinking, as it made me consider different approaches before I even started problems.

## Peer Support & Collaboration

<!-- Include an image or a description of feedback you gave that you are proud of (either in a peer review or in Discord). -->

![](images/clipboard-3372051854.png)

<!-- Include a description of how you grew as a collaborator through the weekly pair programming activities.   -->

The main thing that helped me grow as a collaborator was taking other people's inputs and suggestions in a meaningful way. By fully listening to what other people are saying and implementing this, oftentimes I would do it in a different way than I originally intended. This was cool to see as it showed me how other people think, and expanded my brain a little bit to think about different solutions to a problem. Even if they didn't get it right, we could work through the correct solution afterwords. As the talker, I was able to test my ideas fully as well, and work through the same process but on the other side; it was cool to see some of my thoughts fully validated.
